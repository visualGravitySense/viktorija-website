# Исправление проблемы с OAuth редиректом

## Проблема

После входа через Google вы попадаете на страницу с токеном в URL:
```
http://localhost:3000/#access_token=...
```

И видите ошибку `ERR_CONNECTION_REFUSED`.

## Решение

### 1. Убедитесь, что локальный сервер запущен

**Важно:** Перед тестированием OAuth убедитесь, что локальный сервер разработки запущен!

```bash
cd viktorija-web
npm run dev
```

Сервер должен запуститься на `http://localhost:3000` (или другом порту, если 3000 занят).

### 2. Как работает обработка OAuth

После входа через Google:

1. Google перенаправляет на `/bot#access_token=...`
2. Приложение автоматически:
   - Обнаруживает токен в URL
   - Ожидает обработки токена Supabase (до 2 секунд)
   - Получает сессию пользователя
   - Очищает URL от токена
   - Загружает профиль пользователя
   - Перенаправляет на нужный экран

### 3. Если проблема сохраняется

**Проверьте консоль браузера:**
- Откройте Developer Tools (F12)
- Перейдите на вкладку Console
- Проверьте наличие ошибок

**Проверьте переменные окружения:**
- Убедитесь, что `.env.local` существует
- Проверьте, что `VITE_SUPABASE_URL` и `VITE_SUPABASE_ANON_KEY` установлены правильно

**Проверьте настройки Google OAuth в Supabase:**
- Client ID должен быть строкой вида `123456789-...apps.googleusercontent.com` (НЕ URL!)
- Client Secret должен быть установлен
- Redirect URI в Google Cloud Console должен быть: `https://pkwrduyxqsqnbtgplzzj.supabase.co/auth/v1/callback`

### 4. Отладка

Если токен все еще остается в URL, добавьте логирование:

1. Откройте консоль браузера
2. Проверьте, есть ли сообщения об ошибках
3. Проверьте, вызывается ли `handleOAuthCallback()`

### 5. Альтернативное решение

Если автоматическая обработка не работает, можно вручную обновить страницу после входа через Google - Supabase сохранит сессию, и вы автоматически войдете в систему.
